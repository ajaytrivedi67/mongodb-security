systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log

# Where and how to store data.
storage:
  dbPath: /data/db
  journal:
    enabled: true

# how the process runs
processManagement:
  fork: true
  pidFilePath: /var/run/mongodb/mongod.pid  # location of pidfile
  timeZoneInfo: /usr/share/zoneinfo

# network interfaces
net:
  port: 27017
  bindIp: 0.0.0.0  # Listen to local interface only, comment to listen on all interfaces.
  ssl:
    mode: requireSSL
    FIPSMode: true
    PEMKeyFile: /mongo.simagix.com.pem
    CAFile: /ca.crt

# security
security:
  authorization: enabled
  ldap:
    servers: "ldap.simagix.com"
    bind:
       queryUser: "cn=ldapadm,dc=simagix,dc=local"
       queryPassword: "secret"

    # look into the members of the group ou=Groups,dc=simagix,dc=local, whose objectClass is groupOfNames
    # and the DN matches {USER}.  {USER} matches from userToDNMapping
    authz:
      queryTemplate:
        "ou=Groups,dc=simagix,dc=local??sub?(&(objectClass=groupOfNames)(member={USER}))"

    # 1) ken.chen@SIMAGIX.COM: cn=ken.chen,ou=Users,dc=simagix,dc=local
    # 2) ldapadm: cn=ldapadm,dc=simagix,dc=local
    # 3) CN=ken.chen@simagix.com,OU=Users,O=Simagix,L=Atlanta,ST=Georgia,C=US: cn=admin,ou=Users,dc=simagix,dc=local
    # 4) CN=mdb@simagix.com,OU=Users,O=Simagix,L=Atlanta,ST=Georgia,C=US: cn=mdb,ou=Users,dc=simagix,dc=local
    # 5) ken.chen: cn=ken.chen,ou=Users,dc=simagix,dc=local
    userToDNMapping:
      '[
        {
          match: "(.+)@SIMAGIX.COM",
          substitution: "cn={0},ou=Users,dc=simagix,dc=local"
        },
        {
          match: "(ldapadm)",
          substitution: "cn={0},dc=simagix,dc=local"
        },
        {
          match: "CN=ken.chen@simagix.com,OU=Users,O=Simagix,L=Atlanta,ST=Georgia,C=US",
          substitution: "cn=admin,ou=Users,dc=simagix,dc=local"
        },
        {
          match: "CN=(.+)@simagix.com,OU=Users,O=Simagix,L=Atlanta,ST=Georgia,C=US",
          substitution: "cn={0},ou=Users,dc=simagix,dc=local"
        },
        {
          match: "(.+)",
          substitution: "cn={0},ou=Users,dc=simagix,dc=local"
        }
      ]'

# setParameters
setParameter:
  authenticationMechanisms: PLAIN,MONGODB-X509,SCRAM-SHA-1,GSSAPI
